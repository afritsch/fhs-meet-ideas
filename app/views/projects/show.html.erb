<% content_for :title, @project.title %>
<% content_for :headline do %><%= image_tag "/images/headlines/info.png" %> <%= @project.title %><% end %>

<h2><%= t("projects.headlines.description") %></h2>

<% if following?(@project.id) %>
  <p><%= link_to t("followups.links.unfollow"), followup_path(following?(@project.id)), :method => :delete %></p>
<% else %>
  <p><%= link_to t("followups.links.follow"), followups_path(:project_id => @project), :method => :post %></p>
<% end %>

<p><strong><%= t(".published_by") %></strong> <%= @project.fullname %></p>

<p><strong><%= t(".status") %></strong> <%= @project.status %></p>
<p><strong><%= t(".description") %></strong> <%= simple_format(h(@project.description)) %></p>

<% if @roles.count > 0 # ugly but necessary, because exists does not work here %>
  <h2><%= t("projects.headlines.roles") %></h2>
  <ul>
    <% @roles.each do |role| %>
      <li><%= role.title %>: <%if role.fullname? %><%= link_to role.fullname, user_path(role.user_id.to_i) %><% else %><strong><%= t(".wanted") %></strong><%end %></li>
    <% end %>
  </ul>
<% end %>

<% if @appointments.exists? %>
  <h2><%= t("projects.headlines.appointments") %></h2>
  <ul>
    <% @appointments.each do |appointment| %>
      <li><%= l(appointment.date) %> - <%= appointment.description %></li>
    <% end %>
  </ul>
<% end %>

<% if @pictures.exists? %>
  <h2><%= t("projects.headlines.pictures") %></h2>
  <ul>
    <% @pictures.each do |picture| %>
      <div style="float:left;margin-right:10px;">
        <%= picture.title %><br />
        <a class="fancybox" rel="gallery1" href="<%= picture.image_url %>" title="<%= picture.title %>">
          <img src="<%= picture.image_url(:thumb) %>" alt="<%= picture.title %>" />
        </a>
      </div>
    <% end %>
    <div style="clear:both;"></div>
  </ul>
<% end %>

<% if @project.followups.exists? %>
  <h2><%= t("projects.headlines.followups") %></h2>
  <ul>
    <% @project.followups.each do |followup| %>
      <li>
        <a href="<%= url_for(followup.user) %>">
          <%= followup.user.fullname %>
        </a>
      </li>
    <% end %>
  </ul>
<% end %>

<h2 id="comments"><%= t("projects.headlines.comments") %></h2>
<ul>
<% @comments.each do |comment| %>
  <li id="comment_<%= comment.id %>"><%= image_tag avatar_url(comment) %> <%= link_to comment.fullname, user_path(comment.user_id) %> <%= t(".timeText") %> <%= l(comment.created_at) %>:<br />
    <%= simple_format(h(comment.content)) %><br />
  </li>
<% end %>
</ul>
<%= will_paginate @comments, :param_name => "comments_page", :params => { :anchor => "comments" } %>
<%= form_for [@project, @project.comments.build] do |f| %>
  <div>
    <%= f.label :content, t("projects.form.label_comment") %><br />
    <%= f.text_area :content, :rows => 3 %>
  </div>
  <div>
    <%= f.submit t("common.send") %>
  </div>
<% end %>

<h2><%= t(".contact") %></h2>

<%= mail_to @project.email, @project.email, :encode => "hex" %>

<p class="center small"><%= t(".last_modified", :last_modified => l(@project.updated_at)) %></p>

<p><%= link_to t("common.back"), projects_path %></p>
<% if allowed? %>
  <p><%= link_to t("common.edit"), edit_project_path(@project) %></p>
  <p><%= link_to t("common.delete"), project_path(@project), :method => :delete, :data => { :confirm => t(".deleteConfirmation") } %></p>
<% end %>